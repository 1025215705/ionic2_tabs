Array.prototype.del=function(c){c.sort(function(g,f){return g-f});var a=this.concat([]);for(var d=c.length-1;d>=0;d--){a=a.slice(0,c[d]).concat(a.slice(c[d]+1))}return a};try{HTMLImageElement.prototype.loadOnce=function(b){var a=0;this.onload=function(){if(!a){b.call(this,null)}a++}}}catch(e){window={}}(function(a){var c=function(){if(window.navigator){var f=window.navigator.userAgent;if(/Android|android/.test(f)){return"android"}else{if(/iPhone|iPad|iPod/.test(f)){return"ios"}else{return"other"}}}else{return"sandBox"}}();var d={lib:[],definedPs:{},init:function(){this.require("config")},module:function(f,i){var j=[f];if(/\./g.test(f)){j=f.split(".")}var h=-1,k=this;function g(m){h++;var l=j[h];if(h==j.length-1){m[l]=i.call(null,k);return}m[l]?g(m[l]):g(m[l]={})}g(this.lib)},require:function(f){var h=this;var g=document.createElement("script");document.body.appendChild(g);g.src="./js/module/"+f+".js";g.onload=g.onerror=function(i){h.handlerror(i)}},handlerror:function(f){},destroySelf:function(g){delete window[a];var f=new Error(g);throw (f)},reflect:function(k,j,h){var g=this.lib.config.getModuleName(k);var f=g.spaceName;var i=g.actName;switch(f){case"Filter":case"Alteration":return this.lib[f][i].process(j,h);case"ComEffect":return this.lib[i].process(j,h);default:this.destroySelf("AI_ERROR: ")}},reflectEasy:function(g){var f=this.lib.config.getEasyFun(g).actName;return this.definedPs[g]||this.lib.easy.getFun(f)},add:function(k,i,m,l,g,f,h,j){return this.lib.addLayer.add(k,i,m,l,g,f,h,j)},worker:function(f,g){},applyMatrix:function(g,f){},tools:function(h,g){var f=Array.prototype.shift.call(g);if(this.lib.Tools[f]){return this.lib.Tools[f].process(h,g)}else{throw new Error("AI_ERROR: 不存在的工具方法_"+f)}},definePs:function(f,g){this.definedPs[f]=g}};window[a]=function(n,g,t){var p=this;if(this instanceof window[a]){this.startTime=+new Date();var j=document.createElement("canvas");var h=j.getContext("2d");if(!isNaN(n)){j.width=n;j.height=g;t=t||"#fff";h.fillStyle=t;h.fillRect(0,0,n,g);this.srcImg=""}else{if(typeof n=="string"){var k=new Image();k.onload=function(){j.width=parseInt(this.width);j.height=parseInt(this.height);h.drawImage(this,0,0,this.width,this.height)};k.src=n}else{var f=g,r=t;var s=n.width,o=n.height;var q=s/o;if(g||t){if(!t){r=~~(f/q)}else{if(!g){f=r*q}}}else{f=s;r=o}j.width=f;j.height=r;if(!isNaN(f)){if(c=="ios"){d.lib.Fix.drawImageIOS(h,n,f,r)}else{h.drawImage(n,0,0,f,r)}}else{h.drawImage(n,0,0)}this.srcImg=n}}this.canvas=j;this.context=h;this.imgData=h.getImageData(0,0,j.width,j.height);this.name=a+"_"+Math.random();this.canvas.id=this.name;this.layers=[];var m=document.createElement("canvas");m.width=j.width;m.height=j.height;this.ctxCanvas=m;this.ctxContext=j.getContext("2d");this.width=this.canvas.width;this.height=this.canvas.height;this.useWorker=d.useWorker;this.readyState=1;if(this.useWorker){this.dorsyWorker=d.lib.dorsyWorker(this)}if(d.lib.Tools){for(var l in d.lib.Tools){this.Tools[l]=(function(u){return function(i){return p.Tools(u,i)}})(l)}}}else{return new window[a](n,g,t)}};window[a].module=function(f,g){d.module(f,g)};window[a].dorsyMath=function(){return d.lib.dorsyMath};window[a].setName=function(f){d.name=f||"alloyimage.js"};window[a].getConfig=function(){return d.lib.config.getConfig()};window[a].define=function(f,g){d.definePs(f,g)};window[a].useWorker=function(f){if(!window.Worker){this.useWorker=0;console.log("AI_WARNING: 浏览器不支持web worker, 自动切换为单线程\nAI_WARNING: the brower doesn't support Web Worker");return}var f=f||"";if(/[\/\\]$/.test(f)){f=f+d.name}else{}if(f==""){f="alloyimage.js"}d.useWorker=1;d.path=f;var g=new XMLHttpRequest();g.onreadystatechange=function(){if(g.readyState==4){if(g.status=="404"){d.destroySelf("AI_ERROR：使用worker时，ai文件路径指定错误\nAI_ERROR: error occured while using web worker since indicate the wrong path of file ai")}}};g.open("GET",f,false);g.send()};onmessage=function(h){var f=h.data,g;if(!f){return}if(f[0]=="act"){g=d.reflect(f[1],f[2],f[3])}else{if(f[0]=="add"){g=d.add.apply(d,f[1])}}postMessage(g)};window[a].prototype={set widthfunction(f){this.canvas.width=f},set heightfunction(f){this.canvas.height=f},get widthfunction(){return this.canvas.width},get heightfunction(){return this.canvas.height},act:function(h,f){var g=[];g=Array.prototype.slice.call(arguments,1);if(this.useWorker){this.dorsyWorker.queue.push(["act",h,g]);b.call(this)}else{d.reflect(h,this.imgData,g)}return this},view:function(f,o,l,k,h){if(!f){this.cancel()}else{var g=this.layers.length;if(this.layers[g-1]&&this.layers[g-1][0].type===1){this.cancel()}var p;for(var j=this.layers.length-1;j>-1;j--){var m=this.layers[j];if(m[0].type===2){p=m[0].clone();break}}if(!p){p=this.clone();window.newLayer=p}if(f==="ps"){p=p.ps(o,l,k,h)}else{p.act(f,o,l,k,h)}p.type=1;this.addLayer(p,"正常",0,0)}return this},doView:function(){var f=this.layers.length;if(this.layers[f-1]&&this.layers[f-1][0].type===2){return this}if(this.layers[f-1]&&this.layers[f-1][0].type===1){this.layers[f-1][0].type=2}return this
},undoView:function(){this.cancel();for(var g=this.layers.length-1;g>-1;g--){var f=this.layers[g];if(f[0].type===2){f[0].type=1;break}}return this},excute:function(){var f=this.layers;var g=f.length;if(f[g-1]&&f[g-1][0].type==1){this.imgData=f[g-1][0].imgData;delete f[g-1]}return this},cancel:function(){var f=this.layers;var g=f.length;if(f[g-1]&&f[g-1][0].type==1){f.pop()}return this},complileLayers:function(h){if(this.layers.length==0){this.tempPsLib={imgData:this.imgData}}else{var f=new window[a](this.canvas.width,this.canvas.height);f.add(this,"正常",0,0,h);this.tempPsLib=f;for(var j=0;j<this.layers.length;j++){var g=this.layers[j];var k=g[0].layers;var l=g[0];if(k[k.length-1]&&k[k.length-1][0].type==1){l=k[k.length-1][0]}f.add(l,g[1],g[2],g[3],h)}}},show:function(f,h,g){if(g){}else{if(this.useWorker){this.dorsyWorker.queue.push(["show",f,h]);return this}}this.complileLayers(h);this.context.putImageData(this.tempPsLib.imgData,0,0);if(f){if(typeof f=="string"){var i=document.querySelector(f);i.appendChild(this.canvas)}else{f.appendChild(this.canvas)}}else{document.body.appendChild(this.canvas)}return this},replaceChild:function(f){var g;if(typeof f=="string"){g=document.querySelector(f)}else{g=f}g.innerHTML="";return this.show(g)},replace:function(f,g){if(g){}else{if(this.useWorker){this.dorsyWorker.queue.push(["replace",f]);b.call(this);return this}}if(f){f.onload=function(){};f.src=this.save(0,1,g)}return this},add:function(){var l=[],g,f,h,o,m,n,k;for(var j=0;j<arguments.length;j++){if(!j){continue}switch(typeof(arguments[j])){case"string":if(/\d+%/.test(arguments[j])){h=arguments[j].replace("%","")}else{if(/[RGB]+/.test(arguments[j])){k=arguments[j]}else{f=arguments[j]}}break;case"number":l.push(arguments[j]);break;case"boolean":n=arguments[j];break}}o=l[0]||0;m=l[1]||0;f=f||"正常";h=h/100||1;n=n||false;k=k||"RGB";g=arguments[0];if(this.useWorker){this.dorsyWorker.queue.push(["add",g,f,h,o,m,n,k]);b.call(this)}else{d.add(this.imgData,g.imgData,f,h,o,m,n,k)}return this},addLayer:function(h,i,g,f){this.layers.push([h,i,g,f]);return this},clone:function(g){var f=new window[a](this.canvas.width,this.canvas.height);f.context.putImageData(this.imgData,0,0);f.imgData=f.context.getImageData(0,0,this.canvas.width,this.canvas.height);return f},swap:function(g,f){var h=this.layers[g];this.layers[g]=this.layers[f];this.layers[f]=h;return this},deleteLayers:function(f){this.layers=this.layers.del(f)},save:function(h,f,g){h=h||"png";h=h.toLowerCase();f=f||0.8;if(h=="jpg"){h="jpeg"}var i="image/"+h;if(g){}else{if(this.useWorker){this.dorsyWorker.queue.push(["save"]);b.call(this);return this}}this.complileLayers();this.context.putImageData(this.tempPsLib.imgData,0,0);return this.canvas.toDataURL(i,f)},saveFile:function(l,h){l=l||"AlloyImage合成图像.jpg";h=h||1;var k=/.*.(jpg|png|gif|jpeg)$/g;var j="png";if(k.test(l)){k.lastIndex=0;j=k.exec(l)[1]}else{l+=".png"}var g=this.save(j,h);var f=document.createElement("a");f.href=g;f.download=l;var i=document.createEvent("HTMLEvents");i.initEvent("click",false,false);f.dispatchEvent(i)},download:function(g,f){this.saveFile(g,f)},saveAsDataURL:function(){},saveAsBlob:function(){},saveAsBuffer:function(){},drawRect:function(u,B){var g;if(!B){B="RGB"}var o=(B||"").replace("R","0").replace("G","1").replace("B","2");var z=[o.indexOf("0")>-1,o.indexOf("1")>-1,o.indexOf("2")>-1];if(g=document.getElementById("imgRect")){}else{g=document.createElement("canvas");g.id="imgRect";document.body.appendChild(g);g.width=parseInt(this.canvas.width);g.height=parseInt(this.canvas.height)}var f=g.getContext("2d");f.clearRect(0,0,g.width,g.height);var m=[[],[],[]];this.complileLayers();var A=this.tempPsLib.imgData.data;var r=this.tempPsLib.imgData.width;var p=this.tempPsLib.imgData.height;if(o){for(var h=0;h<p;h++){for(var k=0;k<r;k++){var w=h*r+k;var v=w*4;for(var t=0;t<3;t++){if(z[t]){if(!m[t][A[v+t]]){m[t][A[v+t]]=1}else{m[t][A[v+t]]++}}}}}}else{for(var w=0,q=A.length;w<q;w++){if(!m[A[w]]){m[A[w]]=1}else{m[A[w]]++}}}var l=function(n,y){f.beginPath();f.moveTo(0,g.height);var j=0;for(var C=0;C<255;C++){if(n[C]>j){j=n[C]}}for(var C=0;C<255;C++){var x=n[C]||0;x=g.height-x/j*0.8*g.height;f.lineTo(C/256*g.width,x)}f.lineTo(g.width+10,g.height);f.closePath();f.fillStyle=y;f.fill()};if(o){var s=["red","green","blue"];for(var w=0;w<m.length;w++){if(m[w].length){l(m[w],s[w])}}}else{l(m,"black")}},ps:function(h){if(h=="原图"||h=="origin"||h==""){return this}var f=d.reflectEasy(h);var g=f.call(this,this.canvas);return g},logTime:function(f){},ctx:function(g){var f=this.ctxContext;f.putImageData(this.imgData,0,0);g.call(f);this.imgData=f.getImageData(0,0,this.canvas.width,this.canvas.height);return this},notify:function(f){if(f=="readyStateOK"){this.readyState=1}},complete:function(f){if(this.useWorker){this.dorsyWorker.queue.push(["complete",f])}else{f()}},transform:function(q,j,s){var t=window[a].dorsyMath();var w=this.ctxContext;w.putImageData(this.imgData,0,0);var l=document.createElement("canvas").getContext("2d");
  var v=[new t.Matrix([0,0],"1*2"),new t.Matrix([0,this.canvas.height],"1*2"),new t.Matrix([this.canvas.width,0],"1 * 2"),new t.Matrix([this.canvas.width,this.canvas.height],"1*2")];var r=[];var n=new t.Matrix(q,"2*2");for(var o=0;o<v.length;o++){r.push(v[o].mutiply(n))}var g=Math.max(r[0].data[0][0],r[1].data[0][0],r[2].data[0][0],r[3].data[0][0]);var m=Math.min(r[0].data[0][0],r[1].data[0][0],r[2].data[0][0],r[3].data[0][0]);var f=Math.max(r[0].data[0][1],r[1].data[0][1],r[2].data[0][1],r[3].data[0][1]);var k=Math.min(r[0].data[0][1],r[1].data[0][1],r[2].data[0][1],r[3].data[0][1]);var h=~~(g-m);var u=~~(f-k);l.canvas.width=h;l.canvas.height=u;l.translate(-m,-k);l.transform.apply(l,q);l.drawImage(w.canvas,0,0);this.canvas.width=h;this.canvas.height=u;this.width=h;this.height=u;this.imgData=l.getImageData(0,0,h,u);for(var o=this.layers.length-1;o>-1;o--){var p=this.layers[o];if(p[0].type===2||p[0].type===1){p[0].transform(q,j,s)}}return this},scale:function(f,g){var g=g||f;return this.transform([f,0,0,g,0,0])},scaleTo:function(n,l){var m=this;var i=this.width;var o=this.height;var g,f;if(!l){l=n*o/i}if(!n){n=l*(i/o)}if(0&&this.srcImg){var k=new Image();k.width=n;k.height=l;document.body.appendChild(k);k.style.width=n+"px";k.style.height=~~l+"px";k.src=this.srcImg.src;var j=window[a](k,n,l);document.body.removeChild(k);k=null;setTimeout(function(){if(m.canvas.parentNode){m.canvas.parentNode.replaceChild(j.canvas,m.canvas);j.show()}},10);return j}else{if(n&&l){g=n/i;f=l/o;return this.scale(g,f)}}},rotate:function(h){var g=h/180*Math.PI;var f=[Math.cos(g),Math.sin(g),-Math.sin(g),Math.cos(g),0,0];return this.transform(f)},moveTo:function(f,g){f=f||0;g=g||0;return this.transform([1,0,0,1,f,g])},clip:function(j,i,f,g){this.ctxContext.putImageData(this.imgData,0,0);this.imgData=this.ctxContext.getImageData(j,i,f,g);this.context.canvas.width=f;this.context.canvas.height=g;return this},Tools:function(f){return d.tools(this.imgData,arguments)}};function b(){if(this.readyState){this.readyState=0;this.dorsyWorker.startWorker()}}})("psLib");window.AlloyImage=window.$AI=window.psLib;(function(a){window[a].module("addLayer",function(c){var b={add:function(N,H,aa,U,n,m,E,L){var T=N.data,P=H.data,n=n||0,m=m||0,U=U||1,E=E||false,L=L||"RGB";if(!(/[RGB]+/.test(L))){L="RGB"}var B=L.replace("R","0").replace("G","1").replace("B","2"),r=1,A,f=N.width,g=N.height,o=P.length,I=H.width,R=H.height,d=[B.indexOf("0")>-1,B.indexOf("1")>-1,B.indexOf("2")>-1],w=4*r;var G,v,q,k,Z,F,h;var ab,z,D,S;var Q=n;var t=n+I;var p=m;var K=m+R;if(Q>f){return}else{if(Q<0){Q=0}}if(t<0){return}else{if(t>f){t=f}}if(p>g){return}else{if(p<0){p=0}}if(K<0){return}else{if(K>g){K=g}}var s,V,C;for(var M=p;M<K;M++){s=M*f;V=M-m;C=V*I;for(var O=Q;O<t;O++){var X=O-n;var Y=(s+O)*4;var h=(C+X)*4;for(var W=0;W<3;W++){if(P[h+3]==0){break}else{T[Y+3]=P[h+3]}switch(aa){case"颜色减淡":if(d[W]){A=T[Y+W]+(T[Y+W]*P[h+W])/(255-P[h+W]);T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"变暗":if(d[W]){A=T[Y+W]<P[h+W]?T[Y+W]:P[h+W];T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"变亮":if(d[W]){A=T[Y+W]>P[h+W]?T[Y+W]:P[h+W];T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"正片叠底":if(d[W]){A=~~((T[Y+W]*P[h+W])/255);T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"滤色":if(d[W]){A=~~(255-(255-T[Y+W])*(255-P[h+W])/255);T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"叠加":if(d[W]){if(T[Y+W]<=127.5){A=T[Y+W]*P[h+W]/127.5}else{A=255-(255-T[Y+W])*(255-P[h+W])/127.5}T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"强光":if(d[W]){if(P[h+W]<=127.5){A=T[Y+W]*P[h+W]/127.5}else{A=T[Y+W]+(255-T[Y+W])*(P[h+W]-127.5)/127.5}T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"差值":if(d[W]){A=T[Y+W]>P[h+W]?T[Y+W]-P[h+W]:P[h+W]-T[Y+W];T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"排除":if(d[W]){A=T[Y+W]+P[h+W]-(T[Y+W]*P[h+W])/127.5;T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"点光":if(d[W]){if(T[Y+W]<(2*P[h+W]-255)){A=2*P[h+W]-255}else{if(T[Y+W]<2*P[h+W]){A=T[Y+W]}else{A=2*P[h+W]}}T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"颜色加深":if(d[W]){A=255-255*(255-T[Y+W])/P[h+W];T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"线性加深":if(d[W]){var J=T[Y+W]+P[h+W];A=J>255?J-255:0;T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"线性减淡":if(d[W]){var J=T[Y+W]+P[h+W];A=J>255?255:J;T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"柔光":if(d[W]){if(P[h+W]<127.5){A=((2*P[h+W]-255)*(255-T[Y+W])/(255*255)+1)*T[Y+W]}else{A=(2*P[h+W]-255)*(Math.sqrt(T[Y+W]/255)-T[Y+W]/255)+T[Y+W]}T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"亮光":if(d[W]){if(P[h+W]<127.5){A=(1-(255-T[Y+W])/(2*P[h+W]))*255}else{A=T[Y+W]/(2*(1-P[h+W]/255))}T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"线性光":if(d[W]){var J=T[Y+W]+2*P[h+W]-255;A=J>255?255:J;T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;case"实色混合":if(d[W]){if(P[h+W]<(255-T[Y+W])){A=0}else{A=255}T[Y+W]=(1-U)*T[Y+W]+(U)*A}break;default:if(d[W]){A=P[h+W];T[Y+W]=(1-U)*T[Y+W]+(U)*A}}}}}return N}};return b})})("psLib");(function(a){window[a].module("applyMatrix",function(b){var c={process:function(B,h){var z=h||0.6;var E=B.data;var t=B.width;var r=B.height;var C=new b.lib.dorsyMath.Matrix([-2,-4,-4,-4,-2,-4,0,8,0,-4,-4,8,24,8,-4,-4,0,8,0,-4,-2,-4,-4,-4,-2],25,1);var d=[];for(var x=0,s=E.length;x<s;x+=4){var q=x/4;
  var l=parseInt(q/t);var g=q%t;if(l==0||g==0){continue}var u=[[],[],[]];for(var v=-2;v<3;v++){var o=l+v;for(var f=-2;f<3;f++){var m=g+f;var A=(o*t+m)*4;for(var w=0;w<3;w++){var p=A+w;u[w].push(E[p])}}}var y=new b.lib.dorsyMath.Matrix(u,3,matrixSize);var D=y.mutiply(C);for(var w=0;w<3;w++){d[x+w]=D.data[w]}d[x+4]=E[x+4]}for(var x=0,s=E.length;x<s;x++){E[x]=d[x]||E[x]}return B}};return c})})("psLib");(function(a){window[a].module("config",function(f){var c={Alteration:{"亮度":"brightness","色相/饱和度调节":"setHSI","曲线":"curve","gamma调节":"gamma","可选颜色":"selectiveColor"},Filter:{"灰度处理":"toGray","反色":"toReverse","灰度阈值":"toThresh","高斯模糊":"gaussBlur","浮雕效果":"embossment","查找边缘":"borderline","马赛克":"mosaic","油画":"oilPainting","腐蚀":"corrode","锐化":"sharp","添加杂色":"noise","暗角":"darkCorner","喷点":"dotted","降噪":"denoise","棕褐色":"sepia","色调分离":"posterize"},ComEffect:{"美肤":"softenFace","素描":"sketch","自然增强":"softEnhancement","紫调":"purpleStyle","柔焦":"soften","复古":"vintage","黑白":"gray","仿lomo":"lomo","亮白增强":"strongEnhancement","灰白":"strongGray","灰色":"lightGray","暖秋":"warmAutumn","木雕":"carveStyle","粗糙":"rough"}};var d=function(){var g={};for(var k in c){if(k=="ComEffect"){continue}for(var h in c[k]){g[h]=k;g[c[k][h]]=k}}return g}();var b={getModuleName:function(i){var g;if(g=d[i]){var h=c[g][i]||i;return{spaceName:g,actName:h}}else{throw new Error("AI_ERROR:调用AI不存在的方法"+i)}},getEasyFun:function(g){return{spaceName:"ComEffect",actName:c.ComEffect[g]||g}},getConfig:function(){return c}};return b})})("psLib");(function(a){window[a].module("dorsyMath",function(b){var c={FFT1:function(h){var g=h.length;var k=0;var d=[];for(var f=0;f<g;f++){d[f]=this.exp(-2*Math.PI*f/g)}j();return h;function j(){k++;var m=g/Math.pow(2,k);var o=g/m;for(var n=0;n<m;n++){l(n*o,(n+1)*o-1,k)}if(m>1){j()}else{}}function l(m,p,o){var w=Math.pow(2,o-1);for(var s=m,q=0;s<=(p-w);s++){var x=s+w;var u=q*g/Math.pow(2,o);var r=u+g/4;if(!(h[s] instanceof c.C)){h[s]=new c.C(h[s])}if(!(h[x] instanceof c.C)){h[x]=new c.C(h[x])}var t=h[s].plus(h[x].mutiply(d[u]));var v=h[s].plus(h[x].mutiply(d[r]));h[s]=t;h[x]=v;q++}}},DFT:function(){},Matrix:function(o,q,l){var h=[];if(q){if(isNaN(q)){var f=/(\d+)\s*\*/.exec(q)[1];var d=/\*\s*(\d+)/.exec(q)[1]}else{f=q;d=l}if(o[0]&&o[0][0]){for(var k=0;k<f;k++){h[k]=[];for(var g=0;g<d;g++){h[k][g]=o[k][g]||0}}}else{for(var k=0;k<f;k++){h[k]=[];for(var g=0;g<d;g++){var p=k*d+g;h[k][g]=o[k*d+g]||0}}}this.m=f;this.n=d}else{this.m=o.length;this.n=o[0].length}this.data=h},C:function(f,d){this.r=f||0;this.i=d||0},exp:function(f,g){f=f||0;g=g||1;var d=new c.C();d.r=g*Math.cos(f);d.i=g*Math.sin(f);return d},lagrange:function(i,h){var f=i.length;function g(l,m){var p=1;var j=1;for(var n=0;n<f;n++){if(n!=m){p*=i[m]-i[n];j*=l-i[n]}}var o=j/p;return o}var d=function(l){var j=0;for(var m=0;m<f;m++){var n=g(l,m);j+=h[m]*n}return j};return d},applyMatrix:function(C,B,G){G=G||0;var F=C.data;var u=C.width;var s=C.height;var d=B.length;var D=new c.Matrix(B,d,1);var f=[];var h=-(Math.sqrt(d)-1)/2;for(var y=0,t=F.length;y<t;y+=4){var r=y/4;var m=parseInt(r/u);var l=r%u;if(m==0||l==0){continue}var v=[[],[],[]];for(var w=h;w<=-h;w++){var p=m+w;for(var g=h;g<=-h;g++){var o=l+g;var A=(p*u+o)*4;for(var x=0;x<3;x++){var q=A+x;v[x].push(F[q])}}}var z=new b.lib.dorsyMath.Matrix(v,3,d);var E=z.mutiply(D);for(var x=0;x<3;x++){f[y+x]=E.data[x]}f[y+4]=F[y+4]}for(var y=0,t=F.length;y<t;y++){if(f[y]){F[y]=f[y]<G?f[y]:F[y]}}return C},RGBToHSI:function(j,i,k){var h=((j-i+j-k)/2)/Math.sqrt((j-i)*(j-i)+(j-k)*(i-k))||0;h=Math.acos(h);var g=k>i?(2*Math.PI-h):h;if(j+i+k>0){var f=1-3*Math.min(j,i,k)/(j+i+k)}else{var f=0}var d=(j+i+k)/3;if(g>2*Math.PI){g=2*Math.PI}if(g<0){g=0}return{H:g,S:f,I:d}},HSIToRGB:function(g,f,d){if(g<0){g%=2*Math.PI;g+=2*Math.PI}else{g%=2*Math.PI}if(g<=Math.PI*2/3){var j=d*(1-f);var i=d*(1+f*Math.cos(g)/Math.cos(Math.PI/3-g));var h=3*d-(i+j)}else{if(g<=Math.PI*4/3){g=g-Math.PI*2/3;var i=d*(1-f);var h=d*(1+f*Math.cos(g)/Math.cos(Math.PI/3-g));var j=3*d-(h+i)}else{g=g-Math.PI*4/3;var h=d*(1-f);var j=d*(1+f*Math.cos(g)/Math.cos(Math.PI/3-g));var i=3*d-(h+j)}}return{R:i,G:h,B:j}},applyInHSI:function(f,j){var k=["R","Y","G","C","B","M"];var m=f.data;var s=Math.PI/6;var q=Math.PI/3;for(var o=0,g=m.length;o<g;o+=4){var t=this.RGBToHSI(m[o],m[o+1],m[o+2]);var p=t.H+s;var l=~~(p/q);var d=k[l%6];j(t,d,m[o+3]);if(t.S>1){t.S=1}if(t.S<0){t.S=0}var r=this.HSIToRGB(t.H,t.S,t.I);m[o]=r.R;m[o+1]=r.G;m[o+2]=r.B}},applyInCoordinate:function(f,d){},distance:function(g,f){f=f||[0,0];g=new c.C(g[0],g[1]);f=new c.C(f[0],f[1]);var d=g.minus(f);return d.distance()},xyToIFun:function(d){return function(f,h,g){g=g||0;return(h*d+f)*4+g}},xyCal:function(d,m,l,f,i){var n=this.xyToIFun(d.width);var g=n(m,l,0);var h=d.data;var k=f(h[g],h[g+1],h[g+2]);if(k){h[g]=k[0];h[g+1]=k[1];h[g+2]=k[2]}if(i){h[g+3]=i(h[g+3])}}};c.Matrix.prototype={plus:function(d){if(this.m!=d.m||this.n!=d.n){throw new Error("矩阵加法行列不匹配")}var h=new c.Matrix([],this.m,this.n);for(var g=0;g<this.m;g++){for(var f=0;f<this.n;f++){h.data[g][f]=this.data[g][f]+d.data[g][f]
}}return h},minus:function(d){if(this.m!=d.m||this.n!=d.n){throw new Error("矩阵减法法行列不匹配")}var h=new c.Matrix([],this.m,this.n);for(var g=0;g<this.m;g++){for(var f=0;f<this.n;f++){h.data[g][f]=this.data[g][f]-d.data[g][f]}}return h},mutiply:function(d){if(this.n!=d.m){throw new Error("矩阵乘法行列不匹配")}var h=new c.Matrix([],this.m,d.n);for(var g=0;g<this.m;g++){for(var f=0;f<d.n;f++){var l=0;for(var k=0;k<this.n;k++){l+=this.data[g][k]*d.data[k][f]}h.data[g][f]=l}}return h}};c.C.prototype={plus:function(f){var d=new c.C();d.r=this.r+f.r;d.i=this.i+f.i;return d},minus:function(f){var d=new c.C();d.r=this.r-f.r;d.i=this.i-f.i;return d},mutiply:function(f){var d=new c.C();d.r=this.r*f.r-this.i*f.i;d.i=this.r*f.i+this.i*f.r;return d},divide:function(i){var g=new c.C();var d=i.mutiply(i.conjugated());var h=this.mutiply(i.conjugated());g.r=h.r/d.r;g.i=h.i/d.r;return g},conjugated:function(){var d=new c.C(this.r,-this.i);return d},distance:function(){return Math.sqrt(this.r*this.r+this.i*this.i)}};return c})})("psLib");(function(a){window[a].module("dorsyWorker",function(c){var b=200;var d=function(f){var g=new Worker(c.path);if(!g){throw new Error("使用worker时，alloyimage文件目录指定出错")}var h={queue:[],startWorker:function(){this.shiftAction()},shiftAction:function(){var j=this.queue.shift(),l=this;if(!j){setTimeout(function(){j=l.queue.shift();if(!j){f.notify("readyStateOK")}},b);return}var i=j[0];if(i=="act"){g.postMessage(["act",j[1],f.imgData,j[2]])}else{if(i=="add"){function k(){if(j[1].readyState){var m=[f.imgData,j[1].imgData].concat(j.slice(2));g.postMessage(["add",m])}else{setTimeout(function(){k()},b)}}k()}else{if(i=="show"){f.show(j[1],j[2],1);this.shiftAction()}else{if(i=="complete"){j[1]&&j[1]();this.shiftAction()}else{if(i=="clone"){f.clone(1);this.shiftAction()}else{if(i=="save"){f.save(0,1);this.shiftAction()}else{if(i=="replace"){f.replace(j[1],1);this.shiftAction()}}}}}}}},callback:function(i){f.imgData=i;this.shiftAction()}};g.onmessage=function(i){h.callback(i.data)};return h};return d})})("psLib");(function(a){window[a].module("easy",function(b){var c={getFun:function(d){var f={softenFace:function(){var g=this.clone();return g.add(this.act("高斯模糊",10),"滤色").act("亮度",-10,5)},sketch:function(){var g=this.clone();return this.add(g.act("反色").act("高斯模糊",8),"颜色减淡").act("toGray").act("锐化",1)},softEnhancement:function(){return this.act("曲线",[0,190,255],[0,229,255])},purpleStyle:function(){var g=this.clone();return this.add(g.act("高斯模糊",3),"正片叠底","RG")},soften:function(){var g=this.clone();return this.add(g.act("高斯模糊",6),"变暗")},vintage:function(){var g=this.clone();return this.act("灰度处理").add(window[a](this.canvas.width,this.canvas.height,"#808080").act("添加杂色").act("高斯模糊",4).act("色相/饱和度调节",32,19,0,true),"叠加")},gray:function(){return this.act("灰度处理")},lomo:function(){var g=this.clone().add(this.clone(),"滤色").add(this.clone(),"柔光");return g.add(this.clone().act("反色"),"正常","20%","B").act("暗角",6,200)},strongEnhancement:function(){return this.clone().add(this.clone().act("曲线",[0,50,255],[0,234,255]),"柔光")},strongGray:function(){return this.act("灰度处理").act("曲线",[0,61,69,212,255],[0,111,176,237,255])},lightGray:function(){return this.act("灰度处理").act("曲线",[0,60,142,194,255],[0,194,240,247,255])},warmAutumn:function(){var g=this.clone().act("色相/饱和度调节",36,47,8,true).act("暗角",6,150);return this.add(g,"叠加")},carveStyle:function(){var g=this.clone().act("马赛克").act("查找边缘").act("浮雕效果");return this.add(g,"线性光")},rough:function(){return this.add(window[a](this.canvas.width,this.canvas.height,"#000").act("喷点").act("反色").act("浮雕效果"),"叠加")}};return f[d]}};return c})})("psLib");(function(a){window[a].module("Fix",function(f){function d(l){var i=l.naturalWidth,q=l.naturalHeight;var h=document.createElement("canvas");h.width=1;h.height=q;var r=h.getContext("2d");r.drawImage(l,0,0);var k=r.getImageData(0,0,1,q).data;var o=0;var m=q;var p=q;while(p>o){var j=k[(p-1)*4+3];if(j===0){m=p}else{o=p}p=(m+o)>>1}var n=(p/q);return(n===0)?1:n}function b(p,i,n,m,o,j,r,q,h,l){var k=d(i);p.drawImage(i,n*k,m*k,o*k,j*k,r,q,h,l)}function c(p,i,h,k){var m=0,l=0,n=i.width,j=i.height,q=0,o=0;b(p,i,m,l,n,j,q,o,h,k)}var g={drawImageIOS:c,drawImageIOSFix:b};return g})})("psLib");(function(a){window[a].module("Tools",function(b){var c={getColor:{process:function(z,h){var q=b.lib.dorsyMath;var p=q.xyToIFun(z.width),y;var j=[0,0,0];var f=50;var A=Math.PI*2/f,v;var s=[];q.applyInHSI(z,function(t,i,n){if(n>128){v=parseInt(t.H/A);if(s[v]){}else{s[v]=[]}s[v].push([t.S,t.I])}});var u=3;var x=0,l=0;for(var y=0;y<f;y++){if(s[y]&&s[y].length>x){x=s[y].length;l=y}}var k=0,g,r=0,o;for(var y=0;y<s[l].length;y++){k+=s[l][y][0];r+=s[l][y][1]}g=k/s[l].length;o=r/s[l].length;var m=l*A;var d=q.HSIToRGB(m,g,o);var w="rgb("+parseInt(d.R)+","+parseInt(d.G)+","+parseInt(d.B)+")";return w}},toText:{process:function(d,p){var m=d.data,f=d.width,v=d.height,n,q=p[0]||".:;!#@",k=[],o="";console.log(q);var u=b.lib.dorsyMath;var t=u.xyToIFun(d.width);var l,g=255/q.length,h;for(var s=0;s<f;s+=1){for(var r=0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          r<v;r+=1){l=t(s,r,0);n=(m[l]+m[l+1]+m[l+2])/3;h=parseInt(n/g);o+=q[h]}o+="<br />"}return o}}};return c})})("psLib");(function(a){window[a].module("Filter.ImageEnhance",function(b){var c={process:function(d,o,m){var l=arg||0.5;var k=d.data;var f=d.width;var r=d.height;var q=o||{x:10,y:10};var p=m||{x:50,y:40};function h(i){}for(var j=0,g=k.length;j<g;j+=4){}d.data=k;return d}};return c})})("psLib");(function(a){window[a].module("Filter.corrode",function(b){var c={process:function(g,r){var m=parseInt(r[0])||3;var l=g.data;var h=g.width;var p=g.height;var k=m*2+1;for(var o=0;o<h;o++){for(var n=0;n<p;n++){var s=parseInt(Math.random()*m*2)-m;var q=parseInt(Math.random()*m*2)-m;var f=n*h+o;var d=(n+s)*h+o+q;for(var i=0;i<3;i++){l[f*4+i]=l[d*4+i]}}}return g}};return c})})("psLib");(function(a){window[a].module("Filter.darkCorner",function(b){var c={process:function(w,m){var k=parseInt(m[0])||3;var h=m[2]||"round";var q=m[1]||30;var B=w.data;var s=w.width;var r=w.height;var z=k*2+1;var g=s*2/3;var d=r*1/2;var p=b.lib.dorsyMath.distance([g,d]);var t=p*(1-k/10);var v=function(f,D,C,y,j){return D*Math.pow((1-f),3)+3*C*f*Math.pow((1-f),2)+3*y*f*f*(1-f)+j*Math.pow(f,3)};function A(f,E,C){var D=b.lib.dorsyMath.distance([f,E],[g,d]);var j=(D-t)/(p-t);if(j<0){j=0}return v(j,0,0.02,0.3,1)*C*q/255}for(var o=0;o<s;o++){for(var n=0;n<r;n++){var i=n*s+o;for(var u=0;u<3;u++){var l=A(o,n,B[i*4+u]);B[i*4+u]-=l}}}return w}};return c})})("psLib");(function(a){window[a].module("Filter.dotted",function(b){var c={process:function(z,h){var g=parseInt(h[0])||1;var p=parseInt(h[1])||1;var D=z.data;var t=z.width;var q=z.height;var B=g*2+1;var o=[];var v=p*p;for(var l=-g;l<g;l++){for(var k=-g;k<g;k++){if((l*l+k*k)>v){o.push([l,k])}}}var j=b.lib.dorsyMath.xyToIFun(t);for(var l=0,s=parseInt(t/B);l<s;l++){for(var k=0,u=parseInt(q/B);k<u;k++){var f=parseInt((l+0.5)*B);var d=parseInt((k+0.5)*B);for(var w=0;w<o.length;w++){var C=f+o[w][0];var A=d+o[w][1];D[j(C,A,3)]=225;D[j(C,A,2)]=225;D[j(C,A,0)]=225;D[j(C,A,1)]=225}}}return z}};return c})})("psLib");(function(a){window[a].module("Filter.embossment",function(b){var c={process:function(d,t){var m=d.data;var f=d.width;var s=d.height;var p=[];for(var o=0,k=m.length;o<k;o+=4){var r=o/4;var u=parseInt(r/f);var h=r%f;var g=((u-1)*f+(h-1))*4;var q=(u+1)*f*4+(h+1)*4;if(u==0||h==0){continue}for(var l=0;l<3;l++){p[o+l]=m[g+l]-m[q+l]+127.5}p[o+4]=m[o+4]}for(var o=0,k=m.length;o<k;o++){m[o]=p[o]||m[o]}return d}};return c})})("psLib");(function(a){window[a].module("Filter.gaussBlur",function(b){var c={process:function(B,f){var d=B.data;var t=B.width;var q=B.height;var n=[],o=0,m,l,p,A,C,D,w,v,u,z;var h=f[0];var s=f[1];h=Math.floor(h)||3;s=s||h/3;D=1/(Math.sqrt(2*Math.PI)*s);C=-1/(2*s*s);for(w=0,m=-h;m<=h;m++,w++){A=D*Math.exp(C*m*m);n[w]=A;o+=A}for(w=0,z=n.length;w<z;w++){n[w]/=o}for(l=0;l<q;l++){for(m=0;m<t;m++){p=A=C=D=0;o=0;for(v=-h;v<=h;v++){u=m+v;if(u>=0&&u<t){w=(l*t+u)*4;p+=d[w]*n[v+h];A+=d[w+1]*n[v+h];C+=d[w+2]*n[v+h];o+=n[v+h]}}w=(l*t+m)*4;d[w]=p/o;d[w+1]=A/o;d[w+2]=C/o}}for(m=0;m<t;m++){for(l=0;l<q;l++){p=A=C=D=0;o=0;for(v=-h;v<=h;v++){u=l+v;if(u>=0&&u<q){w=(u*t+m)*4;p+=d[w]*n[v+h];A+=d[w+1]*n[v+h];C+=d[w+2]*n[v+h];o+=n[v+h]}}w=(l*t+m)*4;d[w]=p/o;d[w+1]=A/o;d[w+2]=C/o}}B.data=d;return B}};return c})})("psLib");(function(a){window[a].module("Filter.borderline",function(b){var c={process:function(i,d){var h=[-2,-4,-4,-4,-2,-4,0,8,0,-4,-4,8,24,8,-4,-4,0,8,0,-4,-2,-4,-4,-4,-2];var g=[0,1,0,1,-4,1,0,1,0];var f=[];return b.lib.dorsyMath.applyMatrix(i,g,250)}};return c})})("psLib");(function(a){window[a].module("Filter.mosaic",function(b){var c={process:function(g,z){var s=parseInt(z[0])||3;var r=g.data;var h=g.width;var w=g.height;var p=s*2+1;for(var v=0,k=parseInt(h/p);v<k;v++){for(var u=0,l=parseInt(w/p);u<l;u++){var f=[],t=[0,0,0];for(var q=0;q<p;q++){for(var o=0;o<p;o++){var d=(u*p+q)*h+v*p+o;t[0]+=r[d*4];t[1]+=r[d*4+1];t[2]+=r[d*4+2]}}f[0]=t[0]/(p*p);f[1]=t[1]/(p*p);f[2]=t[2]/(p*p);for(var q=0;q<p;q++){for(var o=0;o<p;o++){var d=(u*p+q)*h+v*p+o;r[d*4]=f[0];r[d*4+1]=f[1];r[d*4+2]=f[2]}}}}return g}};return c})})("psLib");(function(a){window[a].module("Filter.noise",function(b){var c={process:function(f,q){var l=parseInt(q[0])||100;var k=f.data;var g=f.width;var p=f.height;var i=l*2+1;for(var o=0;o<g;o++){for(var n=0;n<p;n++){var d=n*g+o;for(var h=0;h<3;h++){var m=parseInt(Math.random()*l*2)-l;k[d*4+h]+=m}}}return f}};return c})})("psLib");(function(a){window[a].module("Filter.oilPainting",function(b){var c={process:function(f,r){var l=parseInt(r[0])||16;var k=f.data;var g=f.width;var q=f.height;var i=l*2+1;for(var o=0;o<g;o++){for(var n=0;n<q;n++){var d=n*g+o;var p=0;for(var h=0;h<3;h++){p+=k[d*4+h]}p=p/3;var m=parseInt(p/l)*l;for(var h=0;h<3;h++){k[d*4+h]=m}}}return f}};return c})})("psLib");(function(a){window[a].module("Filter.posterize",function(b){var c={process:function(f,j){var m=b.lib.dorsyMath;var i=f.data;var g=f.width;var n=f.height;var h=j[0]||20;h=h<1?1:(h>255?255:h);var d=Math.floor(255/h);
  for(var l=0;l<g;l++){for(var k=0;k<n;k++){m.xyCal(f,l,k,function(q,p,o){return[Math.floor(q/d)*d,Math.floor(p/d)*d,Math.floor(o/d)*d]})}}return f}};return c})})("psLib");(function(a){window[a].module("Filter.sepia",function(b){var c={process:function(j){var g=b.lib.dorsyMath;var i=j.data;var h=j.width;var f=j.height;for(var d=0;d<h;d++){for(var k=0;k<f;k++){g.xyCal(j,d,k,function(n,m,l){return[n*0.393+m*0.769+l*0.189,n*0.349+m*0.686+l*0.168,n*0.272+m*0.534+l*0.131]})}}return j}};return c})})("psLib");(function(a){window[a].module("Filter.sharp",function(b){var c={process:function(f,u){var q=u[0]||0.6;var o=f.data;var g=f.width;var t=f.height;for(var p=0,l=o.length;p<l;p+=4){var s=p/4;var w=parseInt(s/g);var k=s%g;if(w==0||k==0){continue}var h=((w-1)*g+(k-1))*4;var d=((w-1)*g+k)*4;var v=(s-1)*4;for(var m=0;m<3;m++){var r=o[p+m]-(o[d+m]+o[v+m]+o[h+m])/3;o[p+m]+=r*q}}return f}};return c})})("psLib");(function(a){window[a].module("Filter.toGray",function(b){var c={process:function(h){var g=h.data;for(var f=0,j=g.length;f<j;f+=4){var d=parseInt((0.299*g[f]+0.578*g[f+1]+0.114*g[f+2]));g[f+2]=g[f+1]=g[f]=d}h.data=g;return h}};return c})})("psLib");(function(a){window[a].module("Filter.toReverse",function(b){var c={process:function(g){var f=g.data;for(var d=0,h=f.length;d<h;d+=4){f[d]=255-f[d];f[d+1]=255-f[d+1];f[d+2]=255-f[d+2]}g.data=f;return g}};return c})})("psLib");(function(a){window[a].module("Filter.toThresh",function(b){var c={process:function(h,d){h=b.reflect("toGray",h);var g=h.data;var d=d[0]||128;for(var f=0,j=g.length;f<j;f++){if((f+1)%4){g[f]=g[f]>d?255:0}}h.data=g;return h}};return c})})("psLib");(function(a){window[a].module("Alteration.brightness",function(b){var c={process:function(d,p){var l=d.data;var r=p[0]/50;var o=p[1]||0;var q=o/50;var g=Math.tan((45+44*q)*Math.PI/180);for(var m=0,f=l.length;m<f;m+=4){for(var h=0;h<3;h++){l[m+h]=(l[m+h]-127.5*(1-r))*g+127.5*(1+r)}}return d}};return c})})("psLib");(function(a){window[a].module("Alteration.curve",function(b){var c={process:function(g,s){var n=b.lib.dorsyMath.lagrange(s[0],s[1]);var l=g.data;var h=g.width;var r=g.height;var o=s[2];if(!(/[RGB]+/.test(o))){o="RGB"}var k=o.replace("R","0").replace("G","1").replace("B","2");var m=[k.indexOf("0")>-1,k.indexOf("1")>-1,k.indexOf("2")>-1];for(var q=0;q<h;q++){for(var p=0;p<r;p++){var d=p*h+q;for(var i=0;i<3;i++){if(!m[i]){continue}l[d*4+i]=n(l[d*4+i])}}}return g}};return c})})("psLib");(function(a){window[a].module("Alteration.gamma",function(b){var c={process:function(f,j){var m=b.lib.dorsyMath;var i=f.data;var g=f.width;var n=f.height;var h;if(j[0]==undefined){h=10}else{h=j[0]}var d=((h+100)/200)*2;for(var l=0;l<g;l++){for(var k=0;k<n;k++){m.xyCal(f,l,k,function(q,p,o){return[Math.pow(q,d),Math.pow(p,d),Math.pow(o,d)]})}}return f}};return c})})("psLib");(function(a){window[a].module("Alteration.selectiveColor",function(b){var c={process:function(A,g){var u=g[0];var q=g[1];var j=g[2];var f=g[3];var k=g[4];var r=g[5]||0;var d={red:"R",green:"G",blue:"B","红色":"R","绿色":"G","蓝色":"B"};var p={cyan:"R",magenta:"G",yellow:"B","青色":"R","洋红":"G","黄色":"B"};var t=function(h){if(d[u]){return Math.max(h.R,h.G,h.B)==h[d[u]]}else{if(p[u]){return Math.min(h.R,h.G,h.B)==h[p[u]]}else{if(u=="black"||u=="黑色"){return Math.min(h.R,h.G,h.B)<128}else{if(u=="white"||u=="白色"){return Math.max(h.R,h.G,h.B)>128}else{if(u=="中性色"){return !((Math.max(h.R,h.G,h.B)<1)||(Math.min(h.R,h.G,h.B)>224))}}}}}};var i=0;var o=0;var z=0;var s=[q,j,f,k];for(var m=0,n=A.width;m<n;m++){for(var l=0,v=A.height;l<v;l++){b.lib.dorsyMath.xyCal(A,m,l,function(F,N,w){var J={R:F,G:N,B:w};var K=[F,N,w];var E=[];if(t(J)){if(d[u]){var h=d[u];var x=F+N+w-Math.max(F,N,w)-Math.min(F,N,w);z=J[h]-x}else{if(p[u]){var C=p[u];var x=F+N+w-Math.max(F,N,w)-Math.min(F,N,w);z=x-J[C]}else{if(u=="black"||u=="黑色"){z=parseInt(127.5-Math.max(F,N,w))*2}else{if(u=="white"||u=="白色"){z=parseInt(Math.min(F,N,w)-127.5)*2}else{if(u=="中性色"){z=255-(Math.abs(Math.max(F,N,w)-127.5)+Math.abs(Math.min(F,N,w)-127.5))}else{return}}}}}for(var D=0;D<3;D++){var y=parseInt(z*(K[D]/255));var I=K[D]-y;var H=parseInt(z*(1-K[D]/255));var M=K[D]+H;var L=(s[D]+k+s[D]*k);if(r){if(K[D]>128){y=H}if(k>0){var O=K[D]-k*y}else{var O=K[D]-k*H}if(O>M){O=M}if(O<I){O=I}H=M-O;y=O-I;if(k<0){y=H}else{}if(s[D]>0){O-=s[D]*y}else{O-=s[D]*H}}else{var O=z*-L+K[D]}if(O>M){O=M}if(O<I){O=I}E[D]=O}return E}})}}return A}};return c})})("psLib");(function(a){window[a].module("Alteration.setHSI",function(b){var c={process:function(j,d){d[0]=d[0]/180*Math.PI;d[1]=d[1]/100||0;d[2]=d[2]/100*255||0;d[3]=d[3]||false;var h=d[4];if(!(/[RGBCMY]+/.test(h))){h="RGBCMY"}var k=h.split("");var g={};for(var f=0;f<k.length;f++){g[k[f]]=1}b.lib.dorsyMath.applyInHSI(j,function(m,l){if(!g[l]){return}if(d[3]){m.H=d[0];m.S=d[1];m.I+=d[2]}else{m.H+=d[0];m.S+=d[1];m.I+=d[2]}});return j}};return c})})("psLib");
